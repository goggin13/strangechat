/*
 * Pusher JavaScript Library v1.9.3
 * http://pusherapp.com/
 *
 * Copyright 2011, Pusher
 * Released under the MIT licence.
 */
if(typeof Function.prototype.scopedTo==="undefined"){Function.prototype.scopedTo=function(e,f){var d=this;return function(){return d.apply(e,Array.prototype.slice.call(f||[]).concat(Array.prototype.slice.call(arguments)))}}}var Pusher=function(e,f){this.options=f||{};this.path="/app/"+e+"?client=js&version="+Pusher.VERSION;this.key=e;this.channels=new Pusher.Channels;this.global_channel=new Pusher.Channel("pusher_global_channel");this.global_channel.global=!0;var d=this;this.connection=new Pusher.Connection(this.key,this.options);this.connection.bind("connected",function(){d.subscribeAll()}).bind("message",function(b){d.send_local_event(b.event,b.data,b.channel)}).bind("disconnected",function(){d.channels.disconnect()}).bind("error",function(b){Pusher.debug("Error",b)});Pusher.instances.push(this);Pusher.isReady&&d.connect()};Pusher.instances=[];Pusher.prototype={channel:function(b){return this.channels.find(b)},connect:function(){this.connection.connect()},disconnect:function(){Pusher.debug("Disconnecting");this.connection.disconnect()},bind:function(b,d){this.global_channel.bind(b,d);return this},bind_all:function(b){this.global_channel.bind_all(b);return this},subscribeAll:function(){for(var b in this.channels.channels){this.channels.channels.hasOwnProperty(b)&&this.subscribe(b)}},subscribe:function(e){var f=this,d=this.channels.add(e,this);this.connection.state==="connected"&&d.authorize(this,function(b,a){b?d.emit("subscription_error",a):f.send_event("pusher:subscribe",{channel:e,auth:a.auth,channel_data:a.channel_data})});return d},unsubscribe:function(b){this.channels.remove(b);this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:b})},send_event:function(e,f,d){Pusher.debug("Event sent (channel,event,data)",d,e,f);e={event:e,data:f};d&&(e.channel=d);this.connection.send(JSON.stringify(e));return this},send_local_event:function(e,f,d){f=Pusher.data_decorator(e,f);d?(d=this.channel(d))&&d.dispatch_with_all(e,f):Pusher.debug("Event recd (event,data)",e,f);this.global_channel.dispatch_with_all(e,f)}};Pusher.Util={extend:function extend(f,a){for(var d in a){f[d]=a[d]&&a[d].constructor&&a[d].constructor===Object?extend(f[d]||{},a[d]):a[d]}return f}};Pusher.debug=function(){if(Pusher.log){for(var b=["Pusher"],d=0;d<arguments.length;d++){typeof arguments[d]==="string"?b.push(arguments[d]):window.JSON==void 0?b.push(arguments[d].toString()):b.push(JSON.stringify(arguments[d]))}Pusher.log(b.join(" : "))}};Pusher.VERSION="1.9.3";Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.channel_auth_endpoint="/pusher/auth";Pusher.connection_timeout=5000;Pusher.cdn_http="http://js.pusherapp.com/";Pusher.cdn_https="https://d3ds63zw57jt09.cloudfront.net/";Pusher.data_decorator=function(b,d){return d};Pusher.allow_reconnect=!0;Pusher.channel_auth_transport="ajax";Pusher.isReady=!1;Pusher.ready=function(){Pusher.isReady=!0;for(var b=0,d=Pusher.instances.length;b<d;b++){Pusher.instances[b].connect()}};(function(){function b(){this.callbacks={};this.global_callbacks=[]}b.prototype.bind=function(d,c){this.callbacks[d]=this.callbacks[d]||[];this.callbacks[d].push(c);return this};b.prototype.emit=function(d,c){this.dispatch_global_callbacks(d,c);this.dispatch(d,c);return this};b.prototype.bind_all=function(c){this.global_callbacks.push(c);return this};b.prototype.dispatch=function(d,c){var h=this.callbacks[d];if(h){for(var g=0;g<h.length;g++){h[g](c)}}else{!this.global&&!(this instanceof Pusher.Connection||this instanceof Pusher.Machine)&&Pusher.debug("No callbacks for "+d,c)}};b.prototype.dispatch_global_callbacks=function(d,c){for(var f=0;f<this.global_callbacks.length;f++){this.global_callbacks[f](d,c)}};b.prototype.dispatch_with_all=function(d,c){this.dispatch(d,c);this.dispatch_global_callbacks(d,c)};this.Pusher.EventsDispatcher=b}).call(this);(function(){function g(e,c){if(e==null){return -1}if(h&&e.indexOf===h){return e.indexOf(c)}for(i=0,l=e.length;i<l;i++){if(e[i]===c){return i}}return -1}function k(f,e,m){if(e[f]!==void 0){e[f](m)}}function d(m,e,o,n){j.EventsDispatcher.call(this);this.actor=m;this.state=void 0;this.errors=[];this.stateActions=n;this.transitions=o;this.transition(e)}var j=this.Pusher,h=Array.prototype.indexOf;d.prototype.transition=function(a,n){var m=this.state,c=this.stateActions;if(m&&g(this.transitions[m],a)==-1){throw Error(this.actor.key+": Invalid transition ["+m+" to "+a+"]")}k(m+"Exit",c,n);k(m+"To"+(a.substr(0,1).toUpperCase()+a.substr(1)),c,n);k(a+"Pre",c,n);this.state=a;this.emit("state_change",{oldState:m,newState:a});k(a+"Post",c,n)};d.prototype.is=function(b){return this.state===b};d.prototype.isNot=function(b){return this.state!==b};j.Util.extend(d.prototype,j.EventsDispatcher.prototype);this.Pusher.Machine=d}).call(this);(function(){function v(b){b.connectionWait=0;b.openTimeout=u.TransportType==="flash"?5000:2000;b.connectedTimeout=2000;b.connectionSecure=b.compulsorySecure;b.connectionAttempts=0}function r(t,k){function h(){s.connectionWait<x&&(s.connectionWait+=p);s.openTimeout<m&&(s.openTimeout+=d);s.connectedTimeout<w&&(s.connectedTimeout+=n);if(s.compulsorySecure!==!0){s.connectionSecure=!s.connectionSecure}s.connectionAttempts++}function b(){s._machine.transition("impermanentlyClosing")}function y(){s._machine.transition("open")}function a(z){var D;z:{try{var C=JSON.parse(z.data);if(typeof C.data==="string"){try{C.data=JSON.parse(C.data)}catch(B){if(!(B instanceof SyntaxError)){throw B}}}D=C;break z}catch(A){s.emit("error",{type:"MessageParseError",error:A,data:z.data})}D=void 0}typeof D!=="undefined"&&(u.debug("Event recd (event,data)",D.event,D.data),D.event==="pusher:connection_established"?s._machine.transition("connected",D.data.socket_id):D.event==="pusher:error"?(s.emit("error",{type:"PusherError",data:D.data}),D.data.code===4001&&s._machine.transition("permanentlyClosing")):D.event!=="pusher:heartbeat"&&s._machine.is("connected")&&s.emit("message",D))}function f(){s._machine.transition("waiting")}function e(){s.emit("error",{type:"WebSocketError"});s.socket.close();s._machine.transition("impermanentlyClosing")}function j(g,A){if(s.state!==g){var z=s.state;s.state=g;u.debug("State changed",z+" -> "+g);s.emit("state_change",{previous:z,current:g});s.emit(g,A)}}var s=this;u.EventsDispatcher.call(this);this.options=u.Util.extend({encrypted:!1},k||{});this.netInfo=new u.NetInfo;u.EventsDispatcher.call(this.netInfo);this._machine=new u.Machine(s,"initialized",q,{initializedPre:function(){s.compulsorySecure=s.options.encrypted;s.key=t;s.socket=null;s.socket_id=null;s.state="initialized"},waitingPre:function(){s._waitingTimer=setTimeout(function(){s._machine.transition("connecting")},s.connectionWait);s.connectionWait>0&&s.emit("connecting_in",s.connectionWait);s.netInfo.isOnLine()===!1||s.connectionAttempts>4?(s.netInfo.isOnLine()===!1&&s.netInfo.bind("online",function(){s._machine.is("waiting")&&s._machine.transition("connecting")}),j("unavailable")):j("connecting")},waitingExit:function(){clearTimeout(s._waitingTimer)},connectingPre:function(){var g;g=u.ws_port;var z="ws://";if(s.connectionSecure){g=u.wss_port,z="wss://"}g=z+u.host+":"+g+"/app/"+s.key+"?client=js&version="+u.VERSION;u.debug("Connecting",g);s.socket=new u.Transport(g);s.socket.onopen=y;s.socket.onclose=f;s.socket.onerror=e;s._connectingTimer=setTimeout(b,s.openTimeout)},connectingExit:function(){clearTimeout(s._connectingTimer)},connectingToWaiting:function(){h()},connectingToImpermanentlyClosing:function(){h()},openPre:function(){s.socket.onmessage=a;s.socket.onerror=e;s.socket.onclose=f;s._openTimer=setTimeout(b,s.connectedTimeout)},openExit:function(){clearTimeout(s._openTimer)},openToWaiting:function(){h()},openToImpermanentlyClosing:function(){h()},connectedPre:function(c){s.socket_id=c;s.socket.onmessage=a;s.socket.onerror=e;s.socket.onclose=function(){s._machine.transition("waiting")};s.netInfo.bind("offline",function(){s._machine.is("connected")&&s.socket.close()});v(s)},connectedPost:function(){j("connected")},connectedExit:function(){j("disconnected")},impermanentlyClosingPost:function(){s.socket.onclose=f;s.socket.close()},permanentlyClosingPost:function(){s.socket.onclose=function(){v(s);s._machine.transition("permanentlyClosed")};s.socket.close()},failedPre:function(){j("failed");u.debug("WebSockets are not available in this browser.")}})}var u=this.Pusher,q={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","impermanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting"]},p=2000,d=2000,n=2000,x=5*p,m=5*d,w=5*n;r.prototype.connect=function(){u.Transport===null?this._machine.transition("failed"):this._machine.is("initialized")?(v(this),this._machine.transition("waiting")):this._machine.is("waiting")?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&this._machine.transition("waiting")};r.prototype.send=function(b){return this._machine.is("connected")?(this.socket.send(b),!0):!1};r.prototype.disconnect=function(){this._machine.is("waiting")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing")};u.Util.extend(r.prototype,u.EventsDispatcher.prototype);this.Pusher.Connection=r;var o=function(){var b=this;window.ononline=function(){b.emit("online",null)};window.onoffline=function(){b.emit("offline",null)}};o.prototype.isOnLine=function(){return window.navigator.onLine};u.Util.extend(o.prototype,u.EventsDispatcher.prototype);this.Pusher.Connection.NetInfo=o}).call(this);Pusher.Channels=function(){this.channels={}};Pusher.Channels.prototype={add:function(e,f){var d=this.find(e);d||(d=Pusher.Channel.factory(e,f),this.channels[e]=d);return d},find:function(b){return this.channels[b]},remove:function(b){delete this.channels[b]},disconnect:function(){for(var b in this.channels){this.channels[b].disconnect()}}};Pusher.Channel=function(b,d){Pusher.EventsDispatcher.call(this);this.pusher=d;this.name=b;this.subscribed=!1};Pusher.Channel.prototype={init:function(){},disconnect:function(){},acknowledge_subscription:function(){this.subscribed=!0},is_private:function(){return !1},is_presence:function(){return !1},authorize:function(b,d){d(!1,{})},trigger:function(b,d){this.pusher.send_event(b,d,this.name);return this}};Pusher.Util.extend(Pusher.Channel.prototype,Pusher.EventsDispatcher.prototype);Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(e,f){var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",Pusher.channel_auth_endpoint,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=function(){if(d.readyState==4){if(d.status==200){var b=JSON.parse(d.responseText);f(!1,b)}else{Pusher.debug("Couldn't get auth info from your webapp",status),f(!0,d.status)}}};d.send("socket_id="+encodeURIComponent(e.connection.socket_id)+"&channel_name="+encodeURIComponent(this.name))},jsonp:function(f,h){var d="socket_id="+encodeURIComponent(f.connection.socket_id)+"&channel_name="+encodeURIComponent(this.name),g=document.createElement("script");Pusher.auth_callbacks[this.name]=function(b){h(!1,b)};g.src=Pusher.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+this.name+"']")+"&"+d;d=document.getElementsByTagName("head")[0]||document.documentElement;d.insertBefore(g,d.firstChild)}};Pusher.Channel.PrivateChannel={is_private:function(){return !0},authorize:function(b,d){Pusher.authorizers[Pusher.channel_auth_transport].scopedTo(this)(b,d)}};Pusher.Channel.PresenceChannel={init:function(){this.bind("pusher_internal:subscription_succeeded",function(b){this.acknowledge_subscription(b);this.dispatch_with_all("pusher:subscription_succeeded",this.members)}.scopedTo(this));this.bind("pusher_internal:member_added",function(b){this.dispatch_with_all("pusher:member_added",this.members.add(b.user_id,b.user_info))}.scopedTo(this));this.bind("pusher_internal:member_removed",function(b){(b=this.members.remove(b.user_id))&&this.dispatch_with_all("pusher:member_removed",b)}.scopedTo(this))},disconnect:function(){this.members.clear()},acknowledge_subscription:function(b){this.members._members_map=b.presence.hash;this.members.count=b.presence.count;this.subscribed=!0},is_presence:function(){return !0},members:{_members_map:{},count:0,each:function(b){for(var d in this._members_map){b({id:d,info:this._members_map[d]})}},add:function(b,d){this._members_map[b]=d;this.count++;return this.get(b)},remove:function(b){var d=this.get(b);d&&(delete this._members_map[b],this.count--);return d},get:function(b){var d=this._members_map[b];return d?{id:b,info:d}:null},clear:function(){this._members_map={};this.count=0}}};Pusher.Channel.factory=function(e,f){var d=new Pusher.Channel(e,f);e.indexOf(Pusher.Channel.private_prefix)===0?Pusher.Util.extend(d,Pusher.Channel.PrivateChannel):e.indexOf(Pusher.Channel.presence_prefix)===0&&(Pusher.Util.extend(d,Pusher.Channel.PrivateChannel),Pusher.Util.extend(d,Pusher.Channel.PresenceChannel));d.init();return d};Pusher.Channel.private_prefix="private-";Pusher.Channel.presence_prefix="presence-";var _require=function(){var b;b=document.addEventListener?function(d,c){d.addEventListener("load",c,!1)}:function(d,c){d.attachEvent("onreadystatechange",function(){(d.readyState=="loaded"||d.readyState=="complete")&&c()})};return function(n,a){function m(f,o){var o=o||function(){},k=document.getElementsByTagName("head")[0],h=document.createElement("script");h.setAttribute("src",f);h.setAttribute("type","text/javascript");h.setAttribute("async",!0);b(h,function(){var c=o;j++;d==j&&setTimeout(c,0)});k.appendChild(h)}for(var j=0,d=n.length,g=0;g<d;g++){m(n[g],a)}}}();(function(){var g=(document.location.protocol=="http:"?Pusher.cdn_http:Pusher.cdn_https)+Pusher.VERSION,k=[];typeof window.JSON==="undefined"&&k.push(g+"/json2.min.js");if(typeof window.WebSocket==="undefined"){window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,k.push(g+"/flashfallback.min.js")}var d=function(){Pusher.NetInfo=Pusher.Connection.NetInfo;return typeof window.WebSocket==="undefined"&&typeof window.MozWebSocket==="undefined"?function(){typeof window.WebSocket!=="undefined"?(Pusher.Transport=window.WebSocket,Pusher.TransportType="flash",window.WEB_SOCKET_SWF_LOCATION=g+"/WebSocketMain.swf",WebSocket.__addTask(function(){Pusher.ready()}),WebSocket.__initialize()):(Pusher.Transport=null,Pusher.TransportType="none",Pusher.ready())}:function(){Pusher.Transport=typeof window.MozWebSocket!=="undefined"?window.MozWebSocket:window.WebSocket;Pusher.TransportType="native";Pusher.ready()}}(),j=function(e){var c=function(){document.body?e():setTimeout(c,0)};c()},h=function(){j(d)};k.length>0?_require(k,h):h()})();var Event=function(a){var b={},c={};b.type="event";b.to=a.to;b.from=a.from;b.toString=function(){return this.type+" ("+this.for_user+")"};b.toJson=function(){return JSON.stringify(b)};return b};var Broadcast=function(a){var b=Event(a);b.type=types.BROADCAST;b.text=a.text;return b};var User=function(a){var b={};b.user_id=a.user_id;b.alias=a.alias;b.session=a.session;b.avatar=a.avatar;b.recentMeetings=a.hasOwnProperty("recentMeetings")?a.recentMeetings:[];b.excludedUsers=a.hasOwnProperty("excludedUsers")?a.excludedUsers:[];return b};var types={PUSHER_LOGIN:"pusher:subscription_succeeded",PUSHER_MEMBER_LOGON:"pusher:member_added",PUSHER_MEMBER_LOGOFF:"pusher:member_removed",BROADCAST:"broadcast",BLACKLIST:"blacklist"};var Channel=function(a){var b={},c={};c.pusher=a.pusher;b.channel_name=a.channel_name+(c.pusher.isLocal()?"-local":"");c.subscribed=false;c.memberToUser=function(d){return User({user_id:d.info.user_id,alias:d.info.name,session:d.info.session,avatar:d.info.avatar})};b.subscribe=function(){if(c.subscribed){return}c.channel=c.pusher.subscribe(b.channel_name);c.channel.bind("subscription_error",function(d){alert("HTTP: "+d+" on subscribe attempt to "+b.channel_name);c.subscribed=false});c.subscribed=true};b.bindBroadcast=function(d){b.bind(types.BROADCAST,d)};b.bindBlackList=function(d){b.bind(types.BLACKLIST,d)};b.bindLogon=function(d){b.bind(types.PUSHER_MEMBER_LOGON,function(e){d(c.memberToUser(e))})};b.bindLogoff=function(d){b.bind(types.PUSHER_MEMBER_LOGOFF,function(e){d(c.memberToUser(e))})};b.bindLogin=function(d){b.bind(types.PUSHER_LOGIN,function(e){var f=[];e.each(function(g){f.push(c.memberToUser(g))});d(f)})};b.bind=function(d,e){b.subscribe();c.channel.bind(d,e)};b.disconnect=function(){c.pusher.unsubscribe(b.channel_name);c.subscribed=false};b.send=function(e,d){c.pusher.send(e,d)};b.push=function(d,e){c.pusher.push(b.channel_name,d,e)};c.init=function(){return b};return c.init()};var RoomMessage=function(a){var b=Event(a);b.type="roommessage";b.text=a.text;return b};var UserIsTyping=function(a){var b=RoomMessage(a);b.type="useristyping";return b};var RoomChannel=function(a){var b=Channel(a),c={};c.types={ROOM_MESSAGE:"roommessage",USER_TYPING:"useristyping",USED_POWER:"usedpower",OPENED_KUBE:"openedkube",REJECTED_KUBE:"rejectedkube"};c.push=function(d){b.push(d.type,d.toJson())};b.bindToMessage=function(d){b.bind(c.types.ROOM_MESSAGE,function(e){d(e)})};b.bindToIsTyping=function(d){b.bind(c.types.USER_TYPING,function(e){d(e)})};b.useKarma=function(e,d,g,f){b.usePower(e,d,g,f?1:0)};b.usePower=function(e,d,g,h){var f="usepower";b.send(f,{power_id:e,channel:b.channel_name,user_id:d.user_id,session:d.session,for_user:g?g.user_id:-1,for_session:g?g.session:"","params[0]":h})};b.bindToOpenKube=function(d){b.bind(c.types.OPENED_KUBE,function(e){d(JSON.parse(e.reward),JSON.parse(e.kube))})};b.bindToRejectedKube=function(d){b.bind(c.types.REJECTED_KUBE,d)};b.bindToUsedPower=function(d){b.bind(c.types.USED_POWER,d)};b.userIsTyping=function(e,d){c.push(UserIsTyping({from:e,text:d}))};b.message=function(e,d){c.push(RoomMessage({from:e,text:d}))};return b};var UserChannel=function(a){a.channel_name=a.user.user_id+"_channel";var b=Channel(a),c={};c.types={NEW_POWER:"newpower",KARMA:"karma",NEW_COINS:"newcoins"};b.bindNewKarmaKube=function(d){b.bind(c.types.KARMA,d)};b.bindNewCoins=function(d){b.bind(c.types.NEW_COINS,d)};b.bindNewPower=function(d){b.bind(c.types.NEW_POWER,d)};return b};var MyUtil=(function(a,b,c,e){var d={};d.debug=function(f){if(window&&window.console){}};d.toTitleCase=function(f){return f.replace(/\w\S*/g,function(g){return g.charAt(0).toUpperCase()+g.substr(1).toLowerCase()})};d.removeFromArray=function(f,h){var g=$.inArray(h,f);if(g===-1){return}f.splice(g,1)};d.serialize=function(h){var g=[],f;for(f in h){if(h.hasOwnProperty(f)){g.push(f+"="+h[f])}}return g.join("&")};return d}());var HTTP=(function(){var a={};a.send=function(c,b,e,j,f){var h=$.ajax,g="json",d=c+"?"+MyUtil.serialize(e),i=false;if(c.indexOf(window.location.host)===-1){c+="?callback=?"}setTimeout(function(){if(!i&&f){f()}},5000);MyUtil.debug("GET "+d);$.ajaxSetup({cache:false});h({type:"GET",url:c,data:e,dataType:g,success:function(k){i=true;if(k.status==="error"){MyUtil.debug("ERROR!!!");MyUtil.debug(k)}if(j){j(k,d)}}});return d};return a}());var APusher=function(a){var b={},c={};c.home_url=a.home_url;if(c.home_url.indexOf(window.location.host)===-1){Pusher.channel_auth_endpoint=c.home_url+"pusher/auth";Pusher.channel_auth_transport="jsonp"}c.pusher=new Pusher("c6c59a2e80e51c248a47");c.session="";c.user_id=-1;b.HideSocketID=false;b.isLocal=function(){return c.home_url.indexOf("localhost")>-1||c.home_url.indexOf("10.0.1.50")>-1};b.setUserInfo=function(e,d){c.session=e;c.user_id=d};b.subscribe=function(d){return c.pusher.subscribe(d)};b.unsubscribe=function(d){return c.pusher.unsubscribe(d)};b.disconnect=function(){return c.pusher.disconnect()};b.bindConnected=function(d){c.pusher.connection.bind("connected",d)};b.getSocketID=function(){return c.pusher.connection.socket_id};b.push=function(f,e,d){var g={user_id:c.user_id,event:e,channel:f,message:d,session:c.session};if(!b.HideSocketID){g.socket_id=b.getSocketID()}b.send("push",g)};b.send=function(f,e){var d=c.home_url+f;HTTP.send(d,"GET",e)};return b};var JoinRequest=function(a){var b=Event(a),c={};b.type="JoinRequest";return b};var AcceptRequest=function(a){var b=Event(a),c={};b.type="AcceptRequest";b.avatar=a.avatar;b.alias=a.alias;b.session=a.session;return b};var MatchMaker=function(a){var b={},c={};c.pusher=a.pusher;a.channel_name="presence-random-chat";c.randomChannel=Channel(a);c.types={JOIN_REQUEST:"JoinRequest",ACCEPT_REQUEST:"AcceptRequest"};c.user=a.user;c.recentMeetings=a.user.recentMeetings.reverse();c.excludedList=a.user.excludedUsers;c.callback=a.callback;c.successful=false;c.CAN_MEET_AGAIN=0;b.membersToChannelName=function(e,d){var f=[e,d];f.sort();return"presence-"+f[0]+"_"+f[1]};c.propsalFailed=function(){c.pendingResponse=false;c.waitingForChat=true};c.metTimesAgo=function(e){var d=c.recentMeetings;return $.inArray(e,d)};c.canIPairWithMember=function(d){var e=c.metTimesAgo(d);return d&&c.user.user_id&&d!==c.user.user_id&&$.inArray(d,c.excludedList)===-1&&(e===-1||e>=c.CAN_MEET_AGAIN)};c.proposeToAll=function(e){var g=e.length,f=0,d=function(){if(!c.successful&&f<g){c.proposeMeetUp(e[f++]);setTimeout(d,1000)}};if(g>0){d()}};c.proposeMeetUp=function(d){c.pendingResponse=d;var e=JoinRequest({from:c.user.user_id,to:d});setTimeout(function(){c.propsalFailed()},1000);c.randomChannel.push(c.types.JOIN_REQUEST,e.toJson())};c.acceptMeetUp=function(e){var d=AcceptRequest({from:c.user.user_id,to:e,session:c.user.session,avatar:c.user.avatar,alias:c.user.alias});c.randomChannel.push(c.types.ACCEPT_REQUEST,d.toJson());c.successful=true};c.returned=false;c.loginToChannel=function(g,d){var f=false,h=null,e=function(){if(c.returned){return}c.returned=true;d.channel=h;c.callback(d);f=true};h=RoomChannel({channel_name:g,pusher:c.pusher});h.subscribe();h.bindLogin(function(i){$.each(i,function(l,j){if(j.user_id===d.user_id){e();return false}})});h.bindLogon(function(i){if(i.user_id===d.user_id){e()}});setTimeout(function(){if(!f){h.disconnect();b.matchMe()}},1500)};b.matchMe=function(){var d=true,e=false;c.randomChannel.subscribe();c.randomChannel.bind(c.types.JOIN_REQUEST,function(f){if(f.to===c.user.user_id&&(d||c.pendingResponse===f.from)){c.acceptMeetUp(f.from);e=f.from}});c.randomChannel.bind(c.types.ACCEPT_REQUEST,function(h){if(h.to===c.user.user_id&&d){d=false;c.randomChannel.disconnect();if(e!==h.from){c.acceptMeetUp(h.from);e=h.from}var f=User({user_id:h.from,avatar:h.avatar,session:h.session,alias:h.alias}),g=b.membersToChannelName(h.from,c.user.user_id);c.loginToChannel(g,f)}});c.randomChannel.bindLogin(function(g){var f=[];$.each(g,function(i,h){if(c.canIPairWithMember(h.user_id)){if($.inArray(h.user_id,f)===-1){f.push(h.user_id)}}c.proposeToAll(f)})});c.randomChannel.bindLogon(function(f){if(c.waitingForChat&&c.canIPairWithMember(f.user_id)){c.proposeMeetUp(f.user_id)}});c.randomChannel.bindLogoff(function(f){if(c.pendingResponse===f.user_id){c.propsalFailed()}})};return b};var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var MyContacts=(function(){var b={},a={};b.contacts={};b.original_title=document.title;b.title_timer=null;a.setPageTitle=function(d,e){var c=false,f=e?d+" enters":"new message from "+d;if(!window.isActive){document.title=f;clearTimeout(b.title_timer);b.title_timer=setInterval(function(){if(c){document.title=f}else{document.title=b.original_title}c=!c},2000)}};a.resetPageTitle=function(){document.title=b.original_title;clearTimeout(b.title_timer)};return a}());window.isActive=true;$(window).focus(function(){MyContacts.resetPageTitle();this.isActive=true});$(window).blur(function(){this.isActive=false});var ChatAPI=function(a){var b={},c={};c.home_url=a.home_url;b.user_id="";c.inputsToWatch=[];b.room_ids=[];c.session_id=null;b.im_talking_to={};b.superPowers=[];b.superPowerDetails={};b.karmaKubes=[];b.coinCount=0;b.user=null;c.superhero_id=a.user_id;c.channels={};c.broadcastHandler=false;c.pusher=false;b.serverErrorCallback=false;b.send=function(d,g,e,f){if(b.user!==null){e.session=b.user.session}return HTTP.send(d,g,e,f,b.serverErrorCallback)};b.getGroupChannel=function(d){var e="presence-group-"+d;return RoomChannel({channel_name:e,pusher:c.pusher})};c.loginCallback=function(f,d,g){if(f.hasOwnProperty("status")&&f.status==="error"){g(f);return}var e=f[c.superhero_id];b.user=User({user_id:e.id,session:e.session_id,alias:e.alias,avatar:e.avatar,recentMeetings:e.recentMeetings,excludedUsers:e.excludedUsers});b.superPowers=e.superPowers;b.superPowerDetails=e.superPowerDetails;b.karmaKubes=e.karmaKubes;b.coinCount=e.coinCount;b.user_id=b.user.user_id;if(g){g(f)}};b.logout=function(){c.pusher.disconnect()};b.login=function(d,f,g,i){var e=c.home_url+"signin",h={sign_in_id:d,avatar:f,alias:g};b.send(e,"POST",h,function(j){if(j.hasOwnProperty("status")&&j.status==="error"){$("#content").html(j.message)}else{c.loginCallback(j,g,i)}})};c.sendMySocketID=function(f){var d=c.home_url+"setsocket",e={user_id:b.user.user_id,socket_id:c.pusher.getSocketID()};b.send(d,"POST",e,f)};b.eliza=function(f,e,h){var d=c.home_url+"eliza",g={channel:f,qry:$.trim(e)};b.send(d,"GET",g,h)};c.addToMetWith=function(d){var e=c.home_url+"users/met_with",f={user_id:b.user.user_id,other_id:d};b.send(e,"GET",f)};b.requestRandomRoom=function(f){var d=function(g){f(g);b.im_talking_to[g.user_id]=g;c.channels[g.channel.channel_name]=g.channel;c.addToMetWith(g.user_id);b.user.recentMeetings.push(g.user_id)},e=MatchMaker({user:b.user,callback:d,pusher:c.pusher,});e.matchMe()};b.spendCoins=function(e,g){var d=c.home_url+"users/spendCoins",f={amount:e,user_id:b.user.user_id};b.send(d,"GET",f,function(h){g(h)})};b.openKube=function(e,f){var d=c.home_url+"openkube",g={kube_id:e,user_id:b.user.user_id,channel:f};b.send(d,"GET",g)};b.rejectKube=function(e,f){var d=c.home_url+"rejectkube",g={kube_id:e,channel:f,user_id:b.user.user_id};b.send(d,"GET",g)};b.checkPowers=function(){$.get(c.home_url+"mock/checkPowers")};b.getBroadcastChannel=function(){return c.broadcastChannel};b.consumeUser=function(d,g){var e=c.home_url+"users/consume",f={consume_user_id:d,user_id:b.user.user_id};b.send(e,"GET",f,g)};c.initUserChannelBindings=function(){b.bindNewKarmaKube=c.userChannel.bindNewKarmaKube;b.bindNewPower=c.userChannel.bindNewPower;b.bindNewCoins=c.userChannel.bindNewCoins};b.bindBroadcast=function(d){c.broadcastHandler=d};c.blacklistWrapper=function(d){if(d.text===b.user.user_id){window.location.reload()}};c.broadcastWrapper=function(d){if(!c.broadcastHandler){alert(d.text)}else{c.broadcastHandler(d)}};b.hideSocketID=function(){c.pusher.HideSocketID=true};c.initPusher=function(d){c.pusher=APusher({home_url:c.home_url});c.pusher.bindConnected(function(){b.login(a.user_id,a.avatar,a.alias,function(e){c.pusher.setUserInfo(b.user.session,b.user.user_id);c.userChannel=UserChannel({user:b.user,pusher:c.pusher});c.initUserChannelBindings();c.sendMySocketID(function(f){if(f.status==="okay"){c.broadcastChannel=Channel({channel_name:"presence-SHCH-broadcast",pusher:c.pusher});c.broadcastChannel.bindBroadcast(c.broadcastWrapper);c.broadcastChannel.bindBlackList(c.blacklistWrapper);if(d){d(e)}}})})})};c.init=function(){c.initPusher(a.login_callback);return b};return c.init()};var TriviaBots={Music:{alias:"Music",startWord:"right on",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/9f608b9bf8437d65e9ffd7df9bada5a0.png"},General:{alias:"General",startWord:"it's on",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/0712cde686264e879899025683dcbb34.png"},Movies:{alias:"Movies",startWord:"play",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/a1c03ee2fa28cf0b0e8fbeea89c2e149.png"},Books:{alias:"Books",startWord:"books",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/f1300b80c2fd0d4b9e36956e7613c952.png"},TV:{alias:"TV",startWord:"TV",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/2b2dcb168dff3b6cbdd03c287e4960d5.png"},Tech:{alias:"Tech",startWord:"tech",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/f1300b80c2fd0d4b9e36956e7613c952.png"},Cats:{alias:"Cats",startWord:"meow",avatar:"http://superheroclubhouse.com/staging/web/assets/images/users/fc1e20beaaad93bff7066aa047380eac.png"}};var TriviaAPI=function(a){var c={},b={};c.user_id=a.user_id;c.home_url=a.home_url;c.home_url+="trivia/";c.batch=null;c.startWord=false;c.question_index=0;c.correct=0;c.states={PROCESSING:{f:function(){},name:"processing"}};c.welcomeInput=function(f,g){var d=c.randomFrom(c.batch.salutationResponses),e=d.text+'  When you are ready, just type "'+c.startWord+'" to begin';c.state=c.states.WAITING;g({type:"SALUTATION",text:e})};c.states.WELCOME={f:c.welcomeInput,name:"welcome"};c.waitingInput=function(d,e){if(d.toLowerCase().replace(/[\W]/g,"")===c.startWord.toLowerCase().replace(/[\W]/g,"")){c.state=c.states.QUESTIONING;e(c.currentQuestion())}else{e({leave:"1",text:"You aren't following simple commands. Come back when you will treat me right."});c.state=c.states.WELCOME}};c.states.WAITING={f:c.waitingInput,name:"waiting"};c.questionInput=function(g,h){g=g.toLowerCase();if(!c.validateAnswer(g)){h(c.randomRepeatResponse());return}c.state=c.states.PROCESSING;var d=c.home_url+"answerQuestion",f=c.currentQuestion().answers[["a","b","c","d"].indexOf(g)],e={qid:c.currentQuestion().id,user_id:c.user_id,aid:f.id};HTTP.send(d,"GET",e);if(f.isCorrect){c.correct++;h(c.randomCorrectResponse());setTimeout(function(){c.incrementAndGetQuestion(h)},500)}else{setTimeout(function(){h({incorrectRetort:c.randomIncorrectResponse(),correctAnswer:c.currentCorrectResponse()});setTimeout(function(){c.incrementAndGetQuestion(h)},500)},500)}};c.states.QUESTIONING={f:c.questionInput,name:"questioning"};c.finishedRoundInput=function(d,e){e({total:c.batch.questions.length,correct:c.correct});c.reportRound(c.batch.questions.length,c.correct);b.startBatch(c.batch.category.name,function(){e({type:"continue",text:'To start another round, just type "'+c.startWord+'"'});c.correct=0;c.state=c.states.WAITING})};c.states.FINISHED_ROUND={f:c.finishedRoundInput,name:"finished_round"};c.finishedInput=function(d,f){var e="You have completed all the questions from this category!  ";e+="Head back to the [[Trivia Page]][["+oApp.base_url+"trivia]] to find some more competition!";f({type:"completed",text:e})};c.states.FINISHED={f:c.finishedInput,name:"finishedinput"};b.input=function(d,e){c.state.f(d,e)};c.randomFrom=function(d){var e=Math.floor(Math.random()*(d.length-1));return d[e]};c.randomRepeatResponse=function(){return c.randomFrom(c.batch.repeatResponses)};c.randomCorrectResponse=function(){return c.randomFrom(c.batch.correctResponses)};c.randomIncorrectResponse=function(){return c.randomFrom(c.batch.incorrectResponses)};c.validateAnswer=function(d){return d.length===1&&"abcd".indexOf(d)>-1};c.incrementAndGetQuestion=function(d){c.question_index++;if(c.question_index>=c.batch.questions.length){c.categoryIsComplete(c.batch.category.name,function(e){if(e){c.state=c.states.FINISHED}else{c.state=c.states.FINISHED_ROUND}c.state.f("",d)})}else{d(c.currentQuestion());c.state=c.states.QUESTIONING}};c.currentCorrectResponse=function(){var d=c.currentQuestion(),e=false;$.each(d.answers,function(f,g){if(g.isCorrect){e=g}});return e};c.currentQuestion=function(){return c.batch.questions[c.question_index]};c.reportRound=function(f,e){var d=c.home_url+"reportRound",g={user_id:c.user_id,total:f,correct:e};HTTP.send(d,"GET",g)};c.categoryIsComplete=function(d,e){b.getAvailableCategories(function(f){e(!f.hasOwnProperty(d))})};b.getAvailableCategories=function(f){var d=c.home_url+"getEligibleTrivia",e={user_id:c.user_id};HTTP.send(d,"GET",e,f)};b.startBatch=function(g,i){var d=c.home_url+"getBatch",h,e=MyUtil.toTitleCase(g),f={user_id:c.user_id,name:e};HTTP.send(d,"GET",f,function(j){if(j.questions.length!==0){c.state=c.states.WELCOME}else{c.state=c.states.FINISHED}c.question_index=0;c.batch=j;h=TriviaBots[c.batch.category.name];c.startWord=h.startWord;if(i){i(User({user_id:-4,alias:h.alias,session:"N/A",avatar:h.avatar}),j)}})};c.init=function(){return b};return c.init()};
/*
 * generated by pyagg on 09/28/2011 04:50:40 PM EST 
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/pusher.min.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/events.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/user.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/channel.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/roomchannel.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/userchannel.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/ChatUtil.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/pusher.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/matchmaker.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/json2.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/MyContacts.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/ChatAPI.js
 * /Users/goggin/Documents/CS/chatmaster/main/public/javascripts/chat/triviaAPI.js
*/
